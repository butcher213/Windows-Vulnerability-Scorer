#get globals
import configVariables as cv
import os
def scoreFirefox():
    errorinfo = ''
    try:
        if cv.FFV_scoreFirefox == True:
            user = cv.FFV_username
            # find the _______.default directory
            FFdirectory = os.listdir('C:/Users/' + user + '/AppData/Roaming/Mozilla/Firefox/Profiles/')
            for directory in FFdirectory:
                if '.default' in directory:
                    FFdefaultDirectory = directory
                    break
            
            #retrieve the secrity settings for firefox
            firefoxSettingsFile = open('C:/Users/' + user + '/AppData/Roaming/Mozilla/Firefox/Profiles/'+ FFdefaultDirectory + '/prefs.js', 'r')

            #read the data
            firefoxSettings = firefoxSettingsFile.read().splitlines()

            #close the file like a good programmer
            firefoxSettingsFile.close()

            #set up the variable to store the html, along with the one that stores the total firefox points
            htmlOutput = ''
            totalPoints = 0
            pointsScored = 0

            #Remember, firefox REMOVES lines when the setting is enabled,
            #so we are checking for REMOVED lines

            #check for automatic updates
            if cv.FFV_AutoUpdates == True:
                totalPoints += 1
                try:
                    firefoxSettings.index('user_pref("app.update.auto", false);')
                    firefoxSettings.index('user_pref("app.update.enabled", false);')
                except:
                    #lines don't exist, so setting is ENABLED
                    pointsScored += 1
                    htmlOutput += '<li>Firefox: automatic updates are enabled</li>'

            #check for popup blocker
            if cv.FFV_PopupBlocker == True:
                totalPoints += 1
                try:
                    firefoxSettings.index('user_pref("dom.disable_open_during_load", false);')
                except:
                    #line doesn't exist, so setting is ENABLED
                    pointsScored += 1
                    htmlOutput += '<li>Firefox: popup blocker is enabled</li>'

            #check for add on warnings
            if cv.FFV_AddOnWarning == True:
                totalPoints += 1
                try:
                    firefoxSettings.index('user_pref("xpinstall.whitelist.required", false);')
                except:
                    #lines don't exist, so setting is ENABLED
                    pointsScored += 1
                    htmlOutput += '<li>Firefox: warn if sites try to install add-ons is enabled</li>'
        else:
            pointsScored = 0
            totalPoints = 0
            htmlOutput = ''
        #return the points scored, total number of points here, and the html to be written
    except:
        
        errorinfo = '<li>Some sort of Firefox error. Firefox may not be installed correctly.</li>'
        pointsScored = 0
        totalPoints = 0
        htmlOutput = ''
    return [pointsScored, totalPoints, htmlOutput, errorinfo]
scoreFirefox()
